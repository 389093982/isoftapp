{% extends 'common/layout.html' %}
{% load staticfiles %}
{% block style %}
    <!--css样式-->
    <link href="{% static 'common/bootstrap-table/src/bootstrap-table.css' %}" rel="stylesheet">
    <link href="{% static 'timer/style/intg_edit.css' %}" rel="stylesheet">
    <link href="{% static 'common/jQuery-searchableSelect/jquery.searchableSelect.css' %}" rel="stylesheet">
{% endblock %}
{% block script %}
    <!--js-->
    <script src="{% static 'common/bootstrap-table/src/bootstrap-table.js' %}"></script>
    <script src="{% static 'common/bootstrap-table/src/locale/bootstrap-table-zh-CN.js' %}"></script>
    <script src="{% static 'common/jQuery-searchableSelect/jquery.searchableSelect.js' %}"></script>
    <script src="{% static 'timer/js/intg_edit.js' %}"></script>
{% endblock %}

{% block main %}
<div class="am-panel-group" id="accordion">
    <div class="am-panel am-panel-success">
        <div class="am-panel-hd">
            <h4 class="am-panel-title" data-am-collapse="{parent: '#accordion', target: '#do-not-say-1'}">DB验证</h4>
        </div>
        <div id="do-not-say-1" class="am-panel-collapse am-collapse am-in">
            <div class="am-panel-bd">
                <!-- DB验证 -->
                <div id="intg_edit_resource">
                    <div class="am-alert am-alert-success">
                        集成点名称:<span style="color:#FFFF66" id="integration_point_name">{{ integration_point_name }}</span>,
                        版本号:<span style="color:#FFFF66" id="integration_point_version">{{integration_point_version}}</span>,
                        源系统:<span style="color:#FFFF66" id="source_client_name">{{source_client_name}}</span>,
                        宿系统:<span style="color:#FFFF66" id="target_client_name">{{target_client_name}}</span>
                    </div>
                    <div style="float:left;width:50%;">
                        <label>源资源组</label>
                        <select name="src_resource" value="{{ timerIntgPoint.source_db_conn }}">
                            {% for src_resource in src_resources %}
                                <option value ="{{ src_resource.resource_name }}">{{ src_resource.resource_name }}</option>
                            {% endfor %}
                        </select><br>
                        <textarea cols="60" rows="5" style="margin-top:20px;" class="src_resource">源资源组加载中...</textarea>
                        <div class="srcMsg" style="display:none;font-size:12px;"></div>
                    </div>
                    <div style="float:left;width:50%;">
                        <label>宿资源组</label>
                        <select name="target_resource"  value="{{ timerIntgPoint.source_db_conn }}">
                            {% for target_resource in target_resources %}
                                <option value ="{{ target_resource.resource_name }}">{{ target_resource.resource_name }}</option>
                            {% endfor %}
                        </select><br>
                        <textarea cols="60" rows="5" style="margin-top:20px;" class="target_resource">宿资源组加载中...</textarea>
                    <div class="destMsg" style="display:none;font-size:12px;"></div>
                    </div>
                </div>
                <div style="clear:both;"></div>
            </div>
        </div>
    </div>

    <div class="am-panel am-panel-success">
        <div class="am-panel-hd">
            <h4 class="am-panel-title" data-am-collapse="{parent: '#accordion', target: '#do-not-say-2'}">sql录入</h4>
        </div>
        <div id="do-not-say-2" class="am-panel-collapse am-collapse">
            <div class="am-panel-bd">
                <div>
                    <div class="alert alert-danger sql_format_error" style="display:none;" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        sql格式错误!
                    </div>
                    <textarea id="sql_source_input" style="width:50%;float:left;" class="form-control" rows="10"></textarea>
                    <textarea id="sql_target_input" style="width:50%;float:right;" class="form-control" rows="10"></textarea>
                    <div style="clear:both;"></div>
                </div>
                <div style="margin-top:5px;margin-bottom:5px;">
                    <button type="button" class="btn btn-danger btn-sm" style="float:right;">
                        <span id="sql_reset" class="glyphicon glyphicon-cog" aria-hidden="true"></span>重置</button>
                    <button id="sql_add" type="button" class="btn btn-success btn-sm" style="float:right;">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>添加/修改</button>
                    <div style="clear:both;"></div>
                </div>

                <div style="margin-top:5px;margin-bottom:5px;">
                    <button id="batch_validate" type="button" class="btn btn-success btn-sm" style="float:right;">
                        <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>批量验证</button>
                    <div style="clear:both;"></div>
                </div>
                <table id="sql_data" class="table table-condensed table-bordered" style="word-break:break-all; word-wrap:break-all;">
                    <tr class="success">
                        <td style="width:30%;">上游sql</td>
                        <td style="width:30%;">下游sql</td>
                        <td style="width:10%;">操作</td>
                        <td style="width:30%;">验证结果</td>
                    </tr>
                    {% for timerIntgStepRelation in timerIntgStepRelations %}
                        <tr class="warning">
                            <td>
                                {% for timerIntgPerstep in timerIntgPersteps %}
                                    {% if timerIntgPerstep.id == timerIntgStepRelation.from_step_id %}
                                        {{ timerIntgPerstep.perstep_conf }}
                                    {% endif %}
                                {% endfor %}
                            </td>
                            <td>
                                {% for timerIntgPerstep in timerIntgPersteps %}
                                    {% if timerIntgPerstep.id == timerIntgStepRelation.to_step_id %}
                                        {{ timerIntgPerstep.perstep_conf }}
                                    {% endif %}
                                {% endfor %}
                            </td>
                            <td>
                                <a href="#" class="sql_view" title="编辑"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                                <a href="#" class="sql_delete" title="删除"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>
                                <a href="#" class="sql_vlidate" title="验证"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></a>
                            </td>
                            <td>
                                <span class='wait_validate'>待验证</span>
                                <span><img class='validating' src='/static/common/img/Loading2.gif' style='width:20px;height:20px;display: none;'></span>
                                <span class='msg'></span><br>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>

    <div class="am-panel am-panel-success">
        <div class="am-panel-hd">
            <h4 class="am-panel-title" data-am-collapse="{parent: '#accordion', target: '#do-not-say-3'}">字段映射</h4>
        </div>
        <div id="do-not-say-3" class="am-panel-collapse am-collapse">
            <div style="margin:5px;">
                <button id="build" type="button" class="btn btn-success btn-sm" style="float:right;">
                    <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>build/refresh</button>
                <div style="clear:both;"></div>
            </div>

            <div style="width:95%;margin:0 auto;margin-bottom:20px;" class="am-panel-group fieldMappingAccordion" id="accordion1">
                <div class="am-panel am-panel-success">
                    <div class="am-panel-hd" style="display:none;">
                        <h4 class="am-panel-title" data-am-collapse="{parent: '#accordion1', target: '#do-not-say-aaa'}">第 i 组字段 mapping</h4>
                    </div>
                    <div id="do-not-say-aaa" class="am-panel-collapse am-collapse">
                        <table class="table table-bordered">
                            <tr class="info">
                                <td>字段名称</td>
                                <td>字段类型</td>
                                <td>字段名称</td>
                                <td>字段类型</td>
                            </tr>
                            <tr class="warning">
                                <td>A</td>
                                <td>B</td>
                                <td>D</td>
                                <td>E</td>
                            </tr>
                            <tr class="danger">
                                <td>A</td>
                                <td>B</td>
                                <td>D</td>
                                <td>E</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div style="margin:5px;">
                <button id="saveIntgConfig" type="button" class="btn btn-success btn-sm" style="float:right;width:100px;">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>保存</button>
            </div>

        </div>
    </div>
</div>

<div>
    <p style="color:blue;">编辑历史</p>
    <hr>
</div>

{% endblock %}



